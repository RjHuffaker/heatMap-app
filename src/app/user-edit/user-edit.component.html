<ng-template #userEditModal let-close="close">
  <div class="modal-header">
    <h4 class="modal-title">
    	<span *ngIf="modalData.mode==='techManager'">Manage Technicians</span>
    </h4>
    <button type="button" class="close" (click)="close()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>

  <div class="modal-body">
  	<div class="container">
	  	
	  	<div class="row" *ngIf="modalData.mode!=='uploadCSV'">
				<div class="col-4">
					<h5 *ngIf="modalData.mode==='techManager'">Technicians Shown</h5>
				</div>

				<div class="col-2 iconDiv text-secondary noselect">
					<span [ngClass]="{'text-success': modalData.userIndex > 0}"
						(click)="moveItemUp(modalData.userIndex)">&#11014;</span>
						&nbsp; &nbsp;
					<span [ngClass]="{ 'text-success': modalData.userIndex > -1
							&& modalData.userIndex < modalData.userList.length-1 }"
						(click)="moveItemDown(modalData.userIndex)">&#11015;</span>
						&nbsp; &nbsp;
				</div>

				<div class="col-6">
					<h5 *ngIf="modalData.mode==='techManager'">Technicians Hidden</h5>
				</div>

				<div class="col-6">
					<div class="scrollDivOuter">
						<div class="scrollDivInner">
							<ul>
								<ng-container *ngFor="let userItem of modalData.userList; index as i">
									<li (click)="selectItem(i)" class="row no-gutters noselect"
										[ngClass]="{'selectedRow': modalData.userIndex===i}">
										<ng-template #tipContent>{{getToolTip(userItem, modalData.itemList)}}</ng-template>
										<div placement="top" [ngbTooltip]="tipContent">
											&nbsp;{{userItem}}
										</div>
										<div class="col text-primary iconDiv text-right">
											<span (click)="unassignItem(i)">&#8658; &nbsp;</span>
										</div>
									</li>
								</ng-container>
							</ul>
						</div>
					</div>
				</div>

				<div class="col-6">
					<div class="scrollDivOuter">
						<div class="scrollDivInner">
							<ul>
								<ng-container *ngFor="let item of modalData.itemList; index as i">
									<li *ngIf="getUserIndex(item.name) < 0" class="row no-gutters noselect hoverBackground">
										<div class="col text-primary iconDiv">
											<span (click)="assignItem(i)">&nbsp; &#8656;</span>
										</div>
										<ng-template #tipContent>{{getToolTip(item.name, modalData.itemList)}}</ng-template>
										<div class="text-right" placement="top" [ngbTooltip]="tipContent">
											{{item.name}}&nbsp;
										</div>
									</li>
								</ng-container>
							</ul>
						</div>
					</div>
				</div>

			</div>
  	</div>
  </div>

</ng-template>

<div *ngIf="currentUser" class="container">
	<div class="row">
		<div class="col">
			<h1>Edit {{currentUser.username}}</h1>
		</div>
	</div>

	<div class="row">
		
		<div class="col-4 col-sm-2">
			<h5>Username:</h5>
		</div>
		<div class="col-8 col-sm-4 col-md-2">
			<input class="form-control" type="text" [(ngModel)]="currentUser.username">
		</div>
		<div class="col-4 col-sm-2">
			<h5>Password:</h5>
		</div>
		<div class="col-8 col-sm-4 col-md-2">
			<button class="btn btn-outline-warning w-100" (click)="resetPassword()">Reset</button>
		</div>
		<div class="col-4 col-sm-2">
			<h5>Role:</h5>
		</div>
		<div class="col-8 col-sm-4 col-md-2">
			<select class="form-control" [(ngModel)]="currentUser.role">
			  <option *ngFor="let role of roles">
			    {{role}}
			  </option>
			</select>
		</div>
	</div>

	<br/>

	<div class="row">
		<div class="col-4 col-sm-2">
			<h5>Show All Techs:</h5>
		</div>
		<div class="col-8 col-sm-4 col-md-2">
			<input class="form-control" type="checkbox"
			[(ngModel)]="currentUser.preferences['allTechs']"
			[(checked)]="currentUser.preferences['allTechs']">
		</div>
	</div>

	<br/>

	<div class="row">

		<div class="col-12">
			<h4>Assigned Technicians:</h4>
		</div>

		<div class="col-12">
			<div class="scrollDivOuter techListDiv">
				<div class="scrollDivInner">
					
					<ul>
						<ng-container *ngFor="let userTech of currentUser.techList; index as i">
							<li *ngIf="userTech" class="row no-gutters hoverBackground"
								(click)="toggleModal('techManager', i)">
								<ng-template #tipContent>{{getToolTip(userTech, techList)}}</ng-template>
								<div placement="top" [ngbTooltip]="tipContent">
									&nbsp;{{userTech}}
								</div>
							</li>
						</ng-container>
						<li (click)="toggleModal('techManager', 0)">
							&nbsp;<strong class="text-primary">+ TECHNICIAN</strong>
						</li>
					</ul>
				</div>
			</div>
		</div>
		
	</div>

	<div class="row" style="margin-top: 16px;">
  	    <div class="col-3 col-md-2">
			<button class="btn btn-success w-100" (click)="saveUser()">Save</button>
		</div>
		<div class="col-3 col-md-2">
			<button class="btn btn-secondary w-100" (click)="goBack()">Cancel</button>
		</div>
		<div class="d-none d-md-block col-md-4"></div>
		<div class="col-3 col-md-2">
			<button class="btn btn-outline-danger w-100" (click)="deleteUser()">Delete</button>
		</div>
	</div>

</div>

<div *ngIf="!currentUser" align="center">
	<img class="pl-3 loadingIcon" src="data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA==" />
</div>